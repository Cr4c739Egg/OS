dod mwr librarys 
cool program
Oreilly
get-item wsman:\localhpost\client\trustedhosts
invoke executes commands on a remote device
stacknumber - 14
public - 10.50.30.185
http://10.50.21.56:8000/
xfreerdp /u:andy.dwyer /v:10.50.30.185 /dynamic-resolution +glyph-cache +clipboard

windows_opstation_CfeM	win_ops	
192.168.65.10, 10.50.24.111
	
linux_opstation_CfeM	nix_ops	
192.168.65.20, 10.50.33.210

http://10.50.21.56:8000 #ctfds

ssh -J andy.dwyer@10.50.30.185 garviel@10.14.0.6 #jump from admin

file-server - 10.14.0.3 BurtMacklinFBI
diff
get-ciminstance win32_

test-path to see if sommething is there

Day 2
regedit.exe
GUI
c:\windows\regedit.exe

or
reg.exe
CMD
reg add, reg query, reg delete

the keys are loaded as psdrives

hklm and hku are only available when remoting, but the other keys can be accessed in those because they are symoblicallly linked in the avail keys

/? for help in cmd prompt

powershell for reg
get-item - used to get an item, like run. reads key values not subkeys
set-item
new-item
get-childitem - doesnt list files, go one folder up to see files. reads the directory of a key

important keys
url history
usb hist HKEY_LOCAL_MACHINE\SYSTEM\CURRENTCONTROLSET\ENUM\USBSTOR:
recent files
profiles 'HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\ProfileList'
page file
search terms for cortana
networklist HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList\Profiles

persistence

HKLM\software\microsoft\windows\currrentversion\run


ADS
a png is a picture, but it also has metadata in other streams. files can be attached to other files in 
other streams and ran when opening it. 
WinDefender does check ads's however
$data has the stream, saving a file to a thumbdrive removes the other streams
ads - set-content .\file.txt -value ""
read it - get-item -stream <name> or cat <file> -stream <name>i

DAY 3 LINUX

get into the non gui boxs, through admin or 
ssh -j andy.dwyer@10.50.30.185 garviel@10.14.0.6
.6 pass is luna

net cmds
iconfig
ip addr
ip neigh
arp
netstat -anpo
man -k edit
sed --help
sudo -l / shows cmds you can run with sudo
sed 's/*replacee*/*replacer*/g'

/ is root
usr cmds in /bin
/sbin is sys progs and executables
/home is user home dirs
/var has var data, logs, temp files
/dev has special devices and device files
/lib has kernel mods and shared libraries
/mount is mount point for storage
/proc is virual file system
/opt is software packages
/media is for removable media
whoami, pwd
octal is r - 4 w - 2 e - 1 for perms
if you cant open a dir u dont have execute perms for the dir, write allows to add or delete files in it, and
read allows u to list the dir
sticky bit allows the perms to be for everybody. Only the user with the sticky bit can do something



windows boot process
how to check if bios or uefi

Type C:\Windows\Panther\Setupact.log | findstr /i "Detected boot environment"
Get-Content C:\Windows\Panther\Setupact.log | Select-String "Detected boot environment"
or
bcdedit | findstr /i winload

winload.exe = BIOS, winload.efi = UEF


kernel starts init that has pid of 1


mbr 512 bytes 


BIG MIKE GOT KILLED IN RUSSIA (SYSV)

BIOS -Basic Input Output System
MBR -Master Boot Record
GRUB -Grand Unified Bootloader
Kernel
Init (SysV or SystemD)
Runlevels


sudo xxd -l 512 -g /dev/vda (hex dump of mbr)
sudo dd if=/dev/vda of=MBRCopy bs=1 count=512 (byte copy, make sure you make copys to not break it)

/etc/grub.d/ to see kernel ver




sudo strace cat /etc/passwd #system calls

sudo lsmod


terra systemd

minas- SysV


cat /etc/inittab #sysv default target

ls -l /etc/rc3.d/ #number is runlevel

/etc/init.d/cgmanager

ls -lisa /lib/sysemd/system/default.target #systemd target

\systemctl cat default.target #systemd
/etc/sytemd/system #can grep for wants, like grep graphical
/etc/init.d/rc #sysV wants

ls -l /lib/systemd/system #wants, targets
ls -l /run/systemd/generator

cat /etc/systemd/system/display.manager

systemctl show -p Wants graphical.target #EASY way, can do requires intead of wants
systemctl list-dependencies graphical.target #white inactive green active red error. first ones before multi-user is 
wants
systemctl cat graphical.target #systemd


postboot

cat /etc/environment #searchpath for cmds/vars. executables are not in the path
/etc/profile #executes when a user loads an interactive shell, can be used for persistence
same with /etc/bash/bashrc




Day 4 important

process validity - Making sure a process is known to be good

abnormal procs - misspeled, using resources for no reason, weird behavior, sus pids
Malware will typically try to blend in, and be unnoticeable

DLLs - code that can be utilized between different apps and services

.ocx - activex controls
.cpl - 
.drv - drivers

get-process | sort -property id | more

0 kernel space 
2 user space

get-process | select name, id, decription | sort -property is | more

process checker - echotrail.io

get-process smss, csrss, lsass | Sort -Property Id


View modules/DLLs used by defined process and their file locations.

Get-Process chrome | foreach {$a} {$_.modules} | more
Get-Process -Name "*chrome*" | Select-Object -ExpandProperty Modules | more

View only modules/DLLs used by Chrome with "chrome" in the name and their file locations.

Get-Process chrome | foreach {$a} {$_.modules} | Where-Object ModuleName -like '*chrome*' | more
Get-Process -Name "*chrome*" | Select-Object -ExpandProperty Modules | Where-Object ModuleName -like '*chrome*' | more
Pipe in a ft -wrap to see full file name/path.

View the processes with PID and PPID sorted by PID

Get-CimInstance Win32_Process | select name,ProcessId,ParentProcessId | sort processid

CMD 

tasklist /v - /svc - /m | more

Display modules/dlls associated to a specific process.

tasklist /m /fi "IMAGENAME eq chrome.exe" | more

Formating options

tasklist /fo:{table|list|csv}`
tasklist /fo:table | more

View only system services and display Name, PID, and the path they are initiated from.

Get-Ciminstance Win32_service | Select Name, Processid, Pathname | more
Pipe in a ft -wrap to see full pathname.


sc query
sc queryex type=service

View extended information for all inactive services.
sc queryex type=service state=inactive
sc /?                           # Basic service enumeration
sc qc                           # Configuration information for a service
sc queryex eventlog             # Information for the eventlog service including pid
sc qdescription eventlog        # Query eventlog service description
sc qc eventlog                  # Show the binary command that loads the service
sc showsid eventlog             # Displays the service SID and status
sc enmudepend                   # Lists the services that cannot run unless the specified service is running

View all currently running services.
net start

services.msc
View Services in the GUI

Pull services up in the Windows search bar and show them around if youâ€™d like.
PsService
Sysinternal Tool

can schedule tasks as persistence

View all properties of the first scheduled task.

Get-ScheduledTask | Select * | select -First 1

View Scheduled Tasks In Command Prompt
schtasks /query /tn "<name>" /v /fo list

task scheduler - gui program

sysinternal tool - autoruns

netstat -ano (p or b[win])

system procs - system32
user procs programfiles


What are some Registry keys that can be used for autoruns?

Registry Keys Locations, Locations connected with Services.

HKLM\Software\Microsoft\Windows\CurrentVerstion\Run - Local Machine

HKLM\Software\Microsoft\Windows\CurrentVerstion\RunOnce

HKLM\System\CurrentControlSet\Services

Remember that the Users have individual Hives with autoruns as well as the Current User.

HKCU\Software\Microsoft\Windows\CurrentVerstion\Run - Current User

HKCU\Software\Microsoft\Windows\CurrentVerstion\RunOnce

HKU\<sid>\Software\Microsoft\Windows\CurrentVerstion\Run - Specific User

HKU\<sid>\Software\Microsoft\Windows\CurrentVerstion\RunOnce

The order in which services are loaded can be adjusted.

HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\ServiceGroupOrder

HKEY_LOCAL_MACHINE\CurrentControlSet\Control\GroupOrderList


UAC


SYSINTERNALS - collection of a bunch of different utilities
net use * http://live.sysinternals.com #gets the tools

or

PS C:\Users\andy.dwyer\Desktop> $wc = new-object System.Net.WebClient 

PS C:\Users\andy.dwyer\Desktop> $wc.DownloadFile("https://download.sysinternals.com/files/SysinternalsSuite.zip",
"$pwd\SysinternalsSuite.zip") 

PS C:\Users\andy.dwyer\Desktop> Expand-Archive SysinternalsSuite.zip 

Location may be different on your box The webclient provides common methods for sending and receiving data to/from a URI (Uniform Resource Identifier)
Download the .zip file from the website
Unzip the file, creates a folder on the desktop

tcpview
pslogon
autoruns
etc

./procmon.exe

LINUX PROCS (cronjob, zombie and orphan procs, services)


procs after startup
[kthreadd] (PID = 2) #all kernel procs are forked from here. Typicaly handle hardware, managde by kernel. 
they also are usually in [] and have PPID of 2
/sbin/init (PID = 1) #all user procs are forked from here or direct ancestor
pri is priority
ni procs nice number

euid defines the access rights for a process.
A second user ID, the real user ID (ruid), indicates who initiated a process.
Users can only modify / interact with files /process that they own or have been shared with them.
A user is an entity that can run processes and own files.

system calls are interactions between procs and kernel
fork() makes a proc by duping it, exec() makes the kernel replace the process


















